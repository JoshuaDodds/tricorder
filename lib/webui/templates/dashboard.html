<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page_title }}</title>
    <link rel="stylesheet" href="{{ static_url('css/dashboard.css') }}" />
    <script type="module" src="{{ static_url('js/dashboard.js') }}" defer></script>
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div class="titles">
          <h1>Dashboard</h1>
          <p>Monitor live capture, browse stored sessions, and inspect configuration.</p>
        </div>
        <div class="header-actions">
          <button id="refresh-button" class="ghost-button" type="button">Refresh</button>
          <div
            id="refresh-indicator"
            class="refresh-indicator"
            role="status"
            aria-live="polite"
            aria-hidden="true"
            data-visible="false"
          >
            <span class="refresh-spinner" aria-hidden="true"></span>
            <span class="refresh-text">Refreshingâ€¦</span>
          </div>
          <div
            id="connection-status"
            class="connection-status"
            role="status"
            aria-live="polite"
            aria-hidden="true"
            data-visible="false"
          ></div>
          <button id="live-stream-toggle" class="primary-button" type="button">Live Stream</button>
        </div>
      </header>
      <section class="status-bar">
        <div class="stat">
          <span class="label">Recordings</span>
          <span class="value" id="recording-count">0</span>
        </div>
        <div class="stat">
          <span class="label">Selected</span>
          <span class="value" id="selected-count">0</span>
        </div>
        <div class="stat storage-stat">
          <span class="label">Storage</span>
          <span class="value" id="storage-usage-text">--</span>
          <div class="storage-progress">
            <div class="storage-progress-bar" id="storage-progress-bar"></div>
          </div>
          <span class="hint" id="storage-hint">--</span>
        </div>
        <div class="stat">
          <span class="label">Last updated</span>
          <span class="value" id="last-updated">--</span>
        </div>
      </section>
      <section class="main-grid">
        <div class="card player-card">
          <div id="live-stream-panel" class="live-stream-panel" aria-hidden="true">
            <div class="live-stream-header">
              <div class="live-stream-titles">
                <h3>Live stream</h3>
                <span id="live-stream-status" class="live-stream-status">Idle</span>
              </div>
              <div class="live-stream-actions">
                <span class="live-stream-metric">Listeners <span id="live-stream-clients">0</span></span>
                <span class="live-stream-metric">Encoder <span id="live-stream-encoder">stopped</span></span>
                <button id="live-stream-close" class="ghost-button small" type="button">Hide</button>
              </div>
            </div>
            <audio id="live-stream-audio" controls preload="auto"></audio>
            <p class="live-stream-hint">Streaming pauses automatically when hidden.</p>
          </div>
          <div class="card-header">
            <h2>Preview</h2>
            <div class="player-meta" id="player-meta">Select a recording to preview.</div>
          </div>
          <audio id="preview-player" controls preload="none"></audio>
          <div class="waveform-section" id="waveform-section">
            <div class="waveform-header">
              <span>Waveform</span>
              <span class="waveform-status" id="waveform-status"></span>
            </div>
            <div class="waveform-container" id="waveform-container" hidden>
              <canvas id="waveform-canvas"></canvas>
              <div
                id="waveform-trigger-marker"
                class="waveform-marker marker-trigger"
                aria-hidden="true"
                data-active="false"
              >
                <span>Trigger</span>
              </div>
              <div
                id="waveform-release-marker"
                class="waveform-marker marker-release"
                aria-hidden="true"
                data-active="false"
              >
                <span>Release</span>
              </div>
              <div id="waveform-cursor" class="waveform-cursor" aria-hidden="true"></div>
            </div>
            <div class="waveform-empty" id="waveform-empty">Select a recording to render its waveform.</div>
          </div>
        </div>
        <div class="card table-card">
            <div class="card-header">
              <h2>Recent recordings</h2>
              <div class="table-actions">
                <button id="select-all" class="ghost-button small" type="button">Select all</button>
                <button id="clear-selection" class="ghost-button small" type="button">Clear</button>
                <button id="delete-selected" class="danger-button small" type="button" disabled>Delete selected</button>
              </div>
            </div>
            <div class="filters-panel">
              <div class="filters-header">
                <h3>Filters</h3>
                <div class="filters-actions">
                  <button id="clear-filters" class="ghost-button small" type="button">Reset</button>
                  <button id="apply-filters" class="primary-button small" type="button">Apply</button>
                </div>
              </div>
              <div class="filters-grid">
                <label class="input-group">
                  <span>Search</span>
                  <input id="filter-search" type="search" placeholder="Name or path" autocomplete="off" />
                </label>
                <label class="input-group">
                  <span>Day</span>
                  <select id="filter-day">
                    <option value="">All days</option>
                  </select>
                </label>
                <label class="input-group">
                  <span>Limit</span>
                  <input id="filter-limit" type="number" min="1" max="1000" value="500" />
                </label>
              </div>
            </div>
            <div class="table-responsive">
              <table id="recordings-table">
                <thead>
                  <tr>
                    <th class="checkbox-cell">
                      <input type="checkbox" id="toggle-all" aria-label="Toggle all" />
                    </th>
                    <th>
                      <button type="button" class="sort-button" data-sort-key="name">
                        Name
                        <span aria-hidden="true" class="sort-indicator"></span>
                      </button>
                    </th>
                    <th>
                      <button type="button" class="sort-button" data-sort-key="day">
                        Day
                        <span aria-hidden="true" class="sort-indicator"></span>
                      </button>
                    </th>
                    <th>
                      <button type="button" class="sort-button" data-sort-key="modified">
                        Updated
                        <span aria-hidden="true" class="sort-indicator"></span>
                      </button>
                    </th>
                    <th>
                      <button type="button" class="sort-button" data-sort-key="duration">
                        Length
                        <span aria-hidden="true" class="sort-indicator"></span>
                      </button>
                    </th>
                    <th>
                      <button type="button" class="sort-button" data-sort-key="size_bytes">
                        Size
                        <span aria-hidden="true" class="sort-indicator"></span>
                      </button>
                    </th>
                    <th>
                      <button type="button" class="sort-button" data-sort-key="extension">
                        Type
                        <span aria-hidden="true" class="sort-indicator"></span>
                      </button>
                    </th>
                    <th class="actions">Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
      <section class="card config-card">
        <div class="card-header">
          <h2>Configuration snapshot</h2>
          <div class="card-subtitle">Read-only view of merged configuration.</div>
        </div>
        <div id="config-viewer" class="code-block" role="region" aria-live="polite"></div>
      </section>
    </div>
  </body>
</html>
